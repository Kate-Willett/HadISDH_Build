Creation of HadISDH multivariate using both PHA and indirect PHA for 
T, Td, Tw, q, e, RH, DPD, WS and SLP

VERSION 3.0.0.2016p based on HadISD.2.0.1.2015p

Note: This uses a new version of HadISD which has a lot more stations, some different stations, 
different station merges and some changes to the HadISD QC code so this constitutes a whole new 
version of HadISDH which should be acompanied by a peer reviewed paper. In this case I don't 
think that there is enough change to be journal worthy - there is a new paper for HadISDv2. So,
I think a technical note should suffice in this case? 

GLOSSARY:
PHA = Pairwise Homogenisation Algorithm v52j Menne and Williams, 2009
IDPHA = indirect PHA applied using changepoint locations from T/DPD and
adjustments derived from each variables own neighbour networks

;------------------------------------------------------------------
BUILD DIRECTORY STRUCTURE:
/data/local/hadkw/HADCRUH2/UPDATE2016/

cp ../UPDATE2015/makeHadISDHdirectories.sh .

change years in file where appropriate

./makeHadISDHdirectories.sh

	-> LISTS_DOCS
	  -> cp most recent HadISD.<version>_candidate_stations_details.txt
	  -> cp most recent isd-history.txt from ftp://ftp.ncdc.noaa.gov/pub/data/noaa to isd-history_downloadedDDJANYYYY_1230.txt
	-> IMAGES
		-> MAPS
		-> TIMESERIES
		-> BUILD
		-> ANALYSIS
		-> OTHER
	-> PROGS (may need some faffing with the git repositories as described below but a straightforward copy appears to work!)
	 -> mkdir HADISDH_BUILD
	 -> cd HADISDH_BUILD
	 -> git init
	 -> git remote add HADISDHOrigin git@github.com:Kate-Willett/HadISDH_Build.git
	 -> git fetch HADISDHOrigin
	 -> git checkout master
	 -> cd ../
	 -> git init
	 -> git remote add ClimExpOrigin git@github.com:Kate-Willett/Climate_Explorer.git
	 -> git fetch ClimExpOrigin
	 -> git checkout master
	 -> mkdir PHA2015
	 -> cd PHA2015
	 -> scp -r ../UPDATE2014/PHA_2014/.* .
	  -> ./makePHAdirecotories.sh
	  -> set up the .conf files, incl files
	-> MONTHLIES 
		-> ASCII -> TABS,TDABS,TWABS,QABS,EABS,RHABS,DPDABS,WSABS,SLPABS
		            TANOMS,TDANOMS,TWANOMS,QABS,EANOMS,RHANOMS,DPDANOMS,
			    WSANOMS,SLPANOMS
			    raw monthly data
		-> HISTORY -> text files with dates of change: resolution,
		              frequency,merge
		-> NETCDF -> file for each station with all raw monthly 
		              variables
		-> HOMOG
			-> IDPHAASCII -> RHDIR,QDIR,EDIR,TWDIR,TDIR
			-> IDPHANETCDF -> RHDIR,QDIR,EDIR,TWDIR,TDIR
			-> PHAASCII -> DPDDIR,TDIR,TDDIR,WSDIR,SLPDIR (and 
			               others if necessary for comparison)
			-> PHANETCDF -> DPDDIR,TDIR,TDDIR, WSDIR, SLPDIR (and 
			               others if necessary for comparison)
	                -> STAT_PLOTS
				-> PHAADJCOMP -> DPDDIR,TDIR,TDDIR,WSDIR,SLPDIR
				                 (and others if necessary for 
						 comparison)
				-> IDADJCOMP -> RHDIR,QDIR,EDIR,TWDIR,TDIR
				-> UNCPLOTS -> RHDIR,QDIR,EDIR,TWDIR,TDIR,TDDIR,
				               DPDDIR, WSDIR,SLPDIR
				
	-> STATISTICS -> contains gridded product and derived statistics
		-> GRIDS
		-> TIMESERIES
		-> OTHER
	-> OTHERDATA
	  -> cp 20CR... files from UPDATE2015/OTHERDATA/

;------------------------------------------------------------------
ORDER
1) SET UP PHA DIRECTORIES
        /data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/
	- set up PHA directories:
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/pha52jgo/data/
	-> makePHAdirectories.sh 
	- change all cases of 15 to 16 and then run ./
	/data/local/hadkw/HADCRUH2/UPDATE2016/PHA2015/pha52jgo/data/hadisdh/
							-> 7316<var>
								-> meta
								-> corr
								-> output
								-> monthly
									-> raw
									-> WMs.r00
									-> FLs.r00							
 	- set up /data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2016/pha52jgo/data/7316<var>.conf
		- change datatag=7315... to datatag=7316...
		- change endyr=2015 to endyr=2016
		- hopefully maxyrs=300000 is ok but may need to be expanded now we're working with 8000+ stations

2) CREATE MONTHLY DATA FROM HOURLY HADISD
create_monthseriesJAN2015.pro	(all variables inclusive)
	- change nowmon, nowyear and version to appropriate values
	- change all innie and outie filepaths to reflect 2016 run
	- change edyear to 2016
	-> make_months_oddtimesJAN2015.pro
	-> calc_evap.pro
	-> match.pro
	
RESULTS:
From 7877 stations we now have 4216 'good' stations and 3661 'too short' stations.	

3) RUN DIRECT PHA FOR T and DPD (and all others to get corr files): 
	- set up /data/local/hadkw/HADCRUH2/UPDATE2015/PROGS/PHA2015/phav52jgo/all_code/source_expand/
	 	 parm_includes/inhomog.parm.MNTHLY.TEST.incl
	- compile from /data/local/hadkw/HADCRUH2/UPDATE2015/PROGS/PHA2015/phav52jgo/all_code/
	- make compile -C source_expand
	- cp /data/local/hadkw/HADCRUH2/UPDATE2015/PROGS/PHA2015/phav52jgo/all_code/source_expand/PHA* 
             /data/local/hadkw/HADCRUH2/UPDATE2015/PROGS/PHA2015/phav52jgo/code/bin/
	- copy goodforHadISDH.<version>_JAN2017.txt into 
		/data/local/hadkw/HADCRUH2/UPDATE2015/PROGS/PHA2015/phav52jgo/data/hadisdh/7316<var>/meta/
	- make 7316<var>_stnlist.tavg from goodforHadISDH.<version>_JAN2017.txt using ->rewrite_stnlist.pro
	- make blank 7316<var>_metadata_file.txt
	   
	- run from /data/local/hadkw/HADCRUH2/UPDATE2014/PROGS/PHA2015/phav52jgo/
	nohup ./testv52i-pha.sh 7316<var> tavg raw 0 0 P > runlogs/7316<var>.log &
	
	OR
	- run from /scratch/hadkw:
	scp -c blowfish -r /data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phav52jgo .
	Check testv52j-phaSPICE.sh has the correct filepaths
	>sbatch --mem=20000 --time=150 --ntasks=1 --output=runlogs/7316<var>.log ./testv52j-phaSPICE.sh 7316<var> tavg raw 0 0 P > runlogs/7316<var>.log &
	
	- AFTER THIS YOU WILL NEED TO REMOVE A FEW STATIONS FROM THE LIST goodforHadISDH.<version>_JAN2017 THAT 
	DID NOT MAKE IT THROUGH PHA (no neighbours?) - create: goodforHadISDH.<version>_PHA<var>_JAN2017.txt
	THESE ARE STORED HERE:
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/pha52jgo/data/hadisdh/7316<var>/corr/
	meta.7316<var>.tavg.r00.<tiemdate>.1.input_nopt_stnlist
	
	Also remove DPD and T missing from: T, q, e, RH, Td and Tw
	
	- copy goodforHadISDH.<version>_PHA<var>_JAN2017.txt to /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/
	
	- create a station list with only those that pass through T AND DPD: 
		goodforHadISDH.<version>_IDPHAall_JAN2017.txt
	- copy goodforHadISDH.<version>_IDPHAall_JAN2017.txt to /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/ 

	- in /corr/ copy corr.* to corr.log for ease of read later 
	>cp corr* corr.log
	
	- copy 'Adj write...' lines from /data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phav52jgo/data/hadisdh/7316<var>/output/PHAv52i... 
	  to a new file HadISDH.land<var>.<version>_JAN2017.log
	>grep -a ^'Adj write:' PHAv52j.FAST.MLY.TEST.YYMMDDHHMM.tavg.7316<var>.r00.out > HadISDH.land<VAR>.<version>_PHA_JAN2017.log

	- copy HadISDH.land<var>.<version>_PHA_JAN2017.log to /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/

NOTE: 
May be some issue with length of filepath maxing out fortran line length. I had
problems with hadisdh7314dpd but not hadisdh7314t or hadisdh7314q. I had no
issues last year but the filepath was different/shorter. For this reason I now use 7316<var>

RESULTS:
T: 4212 stations kept, 4 removed:
69146499999  40.87    141.38            5 JA DRAUGHON RANGE               
85469099999 -27.17   -109.42           69 CI MATAVERI INTL                
91066022701  28.20   -177.38            5 MQ HENDERSON FIELD AIRPORT      
91245041606  19.28    166.65            3 WQ WAKE ISLAND AIRFLD           

DPD: 4209 stations kept, 7 removed:
68994099999 -46.88     37.87           22 SF MARION ISLAND                
85470099999 -27.30    -70.41          298 CI CHAMONATE                    
85488099999 -29.92    -71.20          146 CI LA FLORIDA                   
89002099999 -70.67     -8.25           50 AY NEUMAYER                     
89022099999 -75.45    -26.22           30 AY HALLEY                       
89564099999 -67.60     62.87           16 AY MAWSON                       
91610099999   1.38    173.15            2 KR BONRIKI INTL                 

T and DPD combined: 4205 stations kept, 11 removed
68994099999 -46.88     37.87           22 SF MARION ISLAND                
69146499999  40.87    141.38            5 JA DRAUGHON RANGE               
85469099999 -27.17   -109.42           69 CI MATAVERI INTL                
85470099999 -27.30    -70.41          298 CI CHAMONATE                    
85488099999 -29.92    -71.20          146 CI LA FLORIDA                   
89002099999 -70.67     -8.25           50 AY NEUMAYER                     
89022099999 -75.45    -26.22           30 AY HALLEY                       
89564099999 -67.60     62.87           16 AY MAWSON                       
91066022701  28.20   -177.38            5 MQ HENDERSON FIELD AIRPORT      
91245041606  19.28    166.65            3 WQ WAKE ISLAND AIRFLD           
91610099999   1.38    173.15            2 KR BONRIKI INTL                 

Q: 4211 stations kept, 5 removed: (not yet removed T and DPD stations)
08501099999  39.46    -31.13           34 PO FLORES                       
68906099999 -40.35     -9.88           54 SH GOUGH ISLAND                 
69146499999  40.87    141.38            5 JA DRAUGHON RANGE               
85469099999 -27.17   -109.42           69 CI MATAVERI INTL                
91066022701  28.20   -177.38            5 MQ HENDERSON FIELD AIRPORT      

RH: 4208 stations kept, 8 removed: (not yet removed T and DPD stations)
68994099999 -46.88     37.87           22 SF MARION ISLAND                
85469099999 -27.17   -109.42           69 CI MATAVERI INTL                
85470099999 -27.30    -70.41          298 CI CHAMONATE                    
85488099999 -29.92    -71.20          146 CI LA FLORIDA                   
89022099999 -75.45    -26.22           30 AY HALLEY                       
89564099999 -67.60     62.87           16 AY MAWSON                       
89571099999 -68.58     77.97           23 AY DAVIS                        
91610099999   1.38    173.15            2 KR BONRIKI INTL                 

TD: 4211 stations kept, 5 removed: (not yet removed T and DPD stations)
08501099999  39.46    -31.13           34 PO FLORES                       
68906099999 -40.35     -9.88           54 SH GOUGH ISLAND                 
69146499999  40.87    141.38            5 JA DRAUGHON RANGE               
85469099999 -27.17   -109.42           69 CI MATAVERI INTL                
91066022701  28.20   -177.38            5 MQ HENDERSON FIELD AIRPORT      

E: 4211 stations kept, 5 removed: (not yet removed T and DPD stations)
08501099999  39.46    -31.13           34 PO FLORES                       
68906099999 -40.35     -9.88           54 SH GOUGH ISLAND                 
69146499999  40.87    141.38            5 JA DRAUGHON RANGE               
85469099999 -27.17   -109.42           69 CI MATAVERI INTL                
91066022701  28.20   -177.38            5 MQ HENDERSON FIELD AIRPORT      

TW: 4211 stations kept, 5 removed: (not yet removed T and DPD stations)
08501099999  39.46    -31.13           34 PO FLORES                       
68906099999 -40.35     -9.88           54 SH GOUGH ISLAND                 
69146499999  40.87    141.38            5 JA DRAUGHON RANGE               
85469099999 -27.17   -109.42           69 CI MATAVERI INTL                
91066022701  28.20   -177.38            5 MQ HENDERSON FIELD AIRPORT      

4) INFIL MDIs for MISSING YEARS, SAVE TO HOMOG ASCII DIRECTORY, PLOT RAW vs HOMOG with NEIGHBOURS, FOR T and DPD
OutputPHAASCIIPLOT_JAN2015.py
	THIS ONLY NEEDS TO BE DONE FOR T, DPD and then after IDPHA for Td 	

RESULTS:
DONE T
DONE DPD
DONE Td PHADPD (the version which creates Td from T - DPD) - started but it crashed after 010280!!! Station looks to have been completed ok though.
Restarted at next station 010330 and it seems fine - odd - completed now.

Non-essentials:
DONE q
DONE RH
DONE Td PHA
DONE e
DONE Tw Plots will be oK!!!

ONLY FOR 2016 RUN - Need to redo all with PlotOnly = True becoause anoms plots have blue and red the wrong way around.
Do NOT DO THIS FOR FUTURE RUNS
Redone T - plotonly
Redone DPD - plotonly
Redone Td - plotonly
Redone q - plotonly
Redone RH - plotonly
Redone e - plotonly
No need to redo Tw - new code already
	
5) RUN INDIRECT PHA FOR T (merge adjustment log), q, e, RH and Tw
IndirectPHA_JAN2015.py	(all variables seperately)
	-> LinearTrends.py
	- AFTER RUNNING FOR T create goodforHadISDH<version>_PHADPDtd_JAN2017.txt by removing T noneighbours... stations from
	goodforHadISDH<version>_IDPHAall_JAN2015.txt (or just cp the IDPHAt file) and also remove any additional Td PHA corr fails.
	- input station counts for q, e, Tw, RH, T and Td to plot_HadISDH_adjs_JAN2015.pro 

RESULTS:
DONE T
4200 stations in goods
5 noneighbours:
08501099999 39.4550  -31.1310   34.1 PO FLORES                           5 
47991099999 24.2900  153.9790    6.7 JA MINAMI TORISHIMA                 6 
68906099999-40.3500   -9.8830   54.0 SH GOUGH ISLAND                     6 
91190022516 20.9000 -156.4290   15.5 US KAHULUI AIRPORT                  6 
91232041408 15.1170  145.7330    4.0 CQ SAIPAN/ISLEY (CGS)               6 

Results in 4200 for Td then minus the Td stations failing PHA - which is none because all have already been removed!

DONE q
4199 stations in goods
6 noneighbours
08501099999 39.4550  -31.1310   34.1 PO FLORES                           0 
61901099999-15.9330   -5.6670  436.0 SH ST. HELENA IS.                   5 
68906099999-40.3500   -9.8830   54.0 SH GOUGH ISLAND                     0 
89611099999-66.2830  110.5330   42.0 AY CASEY                            5 
91165022536 21.9840 -159.3410   30.5 US LIHUE AIRPORT                    6 
91176022519 21.4500 -157.7680    7.3 US KANEOHE MCAS                     6 

DONE RH
4197 stations in goods
8 noneighbours
61901099999-15.9330   -5.6670  436.0 SH ST. HELENA IS.                   6 
68104099999-22.9800   14.6450   91.1 WA WALVIS BAY                       5 
68300099999-26.6830   15.2500  139.0 WA LUDERITZ (DIAZ POINT)            6 
78767099999  9.9580  -83.0220    2.1 CS LIMON INTL                       6 
88963099999-63.4000  -56.9830   24.0 AY BASE ESPERANZA                   5 
89571099999-68.5830   77.9670   23.0 AY DAVIS                            0 
91186099999 21.1500 -157.1000  137.0 US MOLOKAI (AMOS)                   6 
91948099999-23.1330 -134.9670   89.0 FP MANGAREVA                        6 

DONE Tw
4200 stations in goods
5 noneighbours
08501099999 39.4550  -31.1310   34.1 PO FLORES                           0 
08505099999 38.5200  -28.7160   36.0 PO HORTA                            6 
68906099999-40.3500   -9.8830   54.0 SH GOUGH ISLAND                     0 
91165022536 21.9840 -159.3410   30.5 US LIHUE AIRPORT                    6 
91176022519 21.4500 -157.7680    7.3 US KANEOHE MCAS                     6 

DONE e
4199 stations in goods
6 noneighbours
08501099999 39.4550  -31.1310   34.1 PO FLORES                           0 
61901099999-15.9330   -5.6670  436.0 SH ST. HELENA IS.                   5 
68906099999-40.3500   -9.8830   54.0 SH GOUGH ISLAND                     0 
89611099999-66.2830  110.5330   42.0 AY CASEY                            5 
91165022536 21.9840 -159.3410   30.5 US LIHUE AIRPORT                    6 
91176022519 21.4500 -157.7680    7.3 US KANEOHE MCAS                     6 

Re-ran T to get blue and red lines the right way around in plots - ok for next year's run.

6) DERIVE Td (and merge adjustment log), SAVE TO HOMOG ASCII DIRECTORY, PLOT RAW vs HOMOG with NEIGHBOURS, FOR Td
OutputPHAASCIIPLOT_JAN2014.py
	- this will need restarting whenever a Td station with no neighbours causes it to fail. Td doesn't need
	neighbours in this case - only for plotting. However, its easiest just to remove these stations from the list for 
	further processing
	NB: Future versions have an'IF NO NEIGHBOURS STILL OUTPUT FILE'

7) Input station counts into plot_HadISDH_adjs_JAN2015.pro

8) CALCULATE MISSED ADJUSTMENT UNCERTAINTY AND PLOT ADJUSTMENT STATISTICS (Magnitude and time distributions)
plot_HadISDH_adjs_JAN2015.pro (all variables seperately)
	- Record missed adjustment uncertainty from plot and changepoint frequency/magnitude stats in program header
	- iterate to find histogram size that looks optimal - tweak 'pseudomax'
	- find all T(IDPHAMG) adjustments greater than 5 and remove those stations from all variable lists (bad
	merges):	goodforHadISDH<version>_PHAdpd_JAN2016.txt
			goodforHadISDH<version>_IDPHAt_JAN2016.txt
			goodforHadISDH<version>_IDPHAq_JAN2016.txt
			goodforHadISDH<version>_IDPHArh_JAN2016.txt
			goodforHadISDH<version>_IDPHAe_JAN2016.txt
			goodforHadISDH<version>_IDPHAtw_JAN2016.txt
			goodforHadISDH<version>_PHADPDtd_JAN2016.txt
	- put missed adjustment uncertainties into create_homogNCDFall_stunc_JAN2016.pro

NB - IF you rerun this you will have to run with _KeptLarge.txt!!!!

RESULTS:	
DONE T ID:
4.14 changepoints per station  (more than 2016)
ABS mean=0.38, st dev=0.53     (mean v sim, stdev higher than 2016)
Mean = -0.02, st dev=0.65      (mean same, stdev higher than 2016)
mean of diffs=0.03, stdev=0.30 (both slightly higher than 2016)
Largest Adjustments (> 5 deg) - 6 unique stations!
71836099999 -21.63 ~2007? MERGED STATION
71749099999 -18.61 ~1978-1995? MERGED STATION
71749099999  17.47 ~1978-1995? MERGED STATION
71836099999  16.28 ~2011? MERGED STATION
71627899999   9.31 ~1977-2012? MERGED STATION
71627899999  -9.17 ~1977-2012? MERGED STATION
02096099999  -7.01 ~1975-1978? MERGED STATION
71836099999   6.64 ~1978-9? MERGED STATION
11993099999  -5.89 ~1984-1993 or 2002-2007? MERGED STATION
71836099999  -5.31 ~1995-2000? MERGED STATION
53588099999   5.09 NOT MERGED

VAST MAJORITY (all except 535880) ARE MERGED - THIS IS TRUE RIGHT DOWN TO 3 deg ADJUSTMENTS (possibly lower too). Need to consider
whether to ditch more stations with large adjustments - and to investigate the merge further - PHA might be an important
post-check on the merging software? 2048 merged stations in total - this is a LOT of stations!
For now - keep with removal of all stations with adjustments > 5 degrees. The 5.09 one (535880) is the first non-merged station so its
plausible that 'real' jumps of this magnitude could be in there but looks like all larger jumps are due to bad merges.

DONE T PHA:
1.58 changepoints per station   (more than 2016)
ABS mean=0.74, st dev=0.70      (mean v sim, stdev higher than 2016)
Mean = -0.10, st dev=1.01       (v sim to 2016)
mean of diffs=-0.01, stdev=0.23 (mean slightly lower, stdev higher than 2016)
Largest Adjustments (> 5 deg) - 5 unique stations!
71836099999 -21.63
71749099999  17.47
71749099999 -16.96
71836099999  16.28
71627899999  -8.97
71627899999   8.86
71836099999   7.02
02096099999  -7.01
11993099999  -5.89
71836099999  -5.31

DONE DPD - PHA
2.90 changepoints per station   (more than 2016)
ABS mean=0.99, st dev=0.72      (mean same, stdev slightly higher than 2016)
Mean = -0.02, st dev=1.23       (mean slightly lower now, stdev slightly higher)
mean of diffs=-0.03, stdev=0.36 ((mean slightly lower now, stdev higher)
Largest Adjustments (> 5 deg) - note how ALL of these are different from the T ones.
T BAD MERGES don't appear so clearly in DPD because the T and Td are merged simultaneously. The
difference between the two (DPD) may not be as large as the difference in T or Td themselves.
For example, the largest DPD adjustment for 718360 is 1.5 deg! Tiny compared to the -21.63 for T. 
41128099999  -8.59 NOT MERGED
41128099999   8.30 NOT MERGED
44287099999   7.44 NOT MERGED
41128099999   7.28 NOT MERGED
44277099999   7.03 NOT MERGED
72487099999  -6.87 MERGED STATION
62103099999   6.77 NOT MERGED
40357099999  -6.75 NOT MERGED
72487099999   6.60 NOT MERGED
44284099999   6.43 NOT MERGED
41128099999   6.40 NOT MERGED
55664099999   6.32 NOT MERGED
94332099999   6.26 NOT MERGED
94488099999   5.95 NOT MERGED
41240099999   5.86
41128099999  -5.82
40260099999  -5.74
40260099999   5.72
60611099999   5.66
04231099999  -5.60
61498099999   5.58
40373099999  -5.58
55578099999   5.38
40362099999  -5.36
40310099999   5.28
40340099999   5.24
94255099999  -5.21
40405099999   5.21
95482099999   5.17
44275099999   5.12
44373099999  -5.08
94326099999   5.06

DONE Td - PHADPD
4.22 changepoints per station   (more than 2016)
ABS mean=0.79, st dev=0.73	(both slightly higher than 2016)
Mean = -0.01, st dev=1.07	(mean same, stdev slightly higher than 2016)
mean of diffs=-0.02, stdev=0.33 (mean slightly lower, stdev slightly higher than 2016)
Largest adjustments (> 5 deg) - note how there are many more than for T. (29 unique stations)
* shows those that are larger than > 5 deg in T.
71836099999 -21.63 *MERGED STATION
71749099999  17.47 *MERGED STATION
71836099999  16.28 *MERGED STATION
71749099999 -15.86 *MERGED STATION
41128099999   8.77 NOT MERGED
71627899999   8.14 *MERGED STATION
44287099999  -7.24 NOT MERGED
41128099999  -7.17 NOT MERGED
61498099999  -7.04 NOT MERGED
02096099999  -7.01 *MERGED STATION
72487099999   6.98 MERGED STATION
44277099999  -6.86 NOT MERGED
71627899999  -6.78 *MERGED STATION
41128099999  -6.57 NOT MERGED
55664099999  -6.45 NOT MERGED
62103099999  -6.40 NOT MERGED
72487099999  -6.28 MERGED STATION
94488099999  -5.95 NOT MERGED
11993099999  -5.89 *MERGED STATION
41240099999  -5.82 MERGED STATION
44284099999  -5.81 NOT MERGED
40260099999   5.79 NOT MERGED
71836099999   5.78 *MERGED STATION
40260099999  -5.75 NOT MERGED
41128099999   5.74 NOT MERGED
40373099999   5.72 NOT MERGED
40340099999  -5.62 NOT MERGED
40310099999  -5.62 NOT MERGED
60611099999  -5.54 NOT MERGED
40362099999   5.40 NOT MERGED
41128099999  -5.40 NOT MERGED
71836099999  -5.31 *MERGED STATION
40394099999  -5.31 NOT MERGED
44373099999   5.26 NOT MERGED
55578099999  -5.23 NOT MERGED
44275099999  -5.21 NOT MERGED
40405099999  -5.21 NOT MERGED
71836099999   5.18 *MERGED STATION
17330099999  -5.06 NOT MERGED
94255099999   5.01 NOT MERGED

DONE Td - PHA
2.49 changepoints per station
ABS mean=0.99, st dev=0.77
Mean = -0.05, st dev=1.26
mean of diffs=-0.01, stdev=0.37
Largest adjustments (> 5 deg) - note how there are many more than for T.
* shows those that are larger than > 5 deg in T.
71836099999 -19.80 *MERGED STATION
71836099999  14.68 *MERGED STATION
71749099999  14.54 *MERGED STATION
71749099999 -13.81 *MERGED STATION
41128099999  10.38 NOT MERGED
41128099999  -7.91 NOT MERGED
71627899999   7.74 *MERGED STATION
40373099999   7.65 NOT MERGED
71836099999   6.93 *MERGED STATION
61498099999  -6.67 NOT MERGED
62103099999  -6.65 NOT MERGED
55578099999  -6.63 NOT MERGED
40405099999   6.46 NOT MERGED
55664099999  -6.31 NOT MERGED
71627899999  -6.24 *MERGED STATION
60611099999  -6.23 NOT MERGED
44347099999   6.12 NOT MERGED
41128099999  -5.95 NOT MERGED
40420099999  -5.69 NOT MERGED
44373099999   5.59 NOT MERGED
44347099999  -5.52 NOT MERGED
40405099999  -5.52 NOT MERGED
44287099999  -5.47 NOT MERGED 
71836099999  -5.46 *MERGED STATION
40809099999  -5.39 NOT MERGED
71836099999   5.28 *MERGED STATION
95482099999  -5.23 MERGED STATION
44298099999  -5.17 NOT MERGED
44277099999  -5.14 NOT MERGED
72487099999  -5.07 MERGED STATION
71842599999   5.02 MERGED STATION
44275099999  -5.02 NOT MERGED

DONE q - ID 
4.33 changepoints per station  (more than 2016)
ABS mean=0.27, st dev=0.30     (v sim as 2016)
Mean = -0.01, st dev=0.40      (identical to 2016)
mean of diffs=0.01, stdev=0.20 (mean = -0.01 in 2016, stdev bigger now)
Largest Adjustments (> 2 g/kg) 
NONE are the same as for T - nearest is 717490 at 2.16 g/kg
Some are same as Td marked +
76577099999   3.65 NOT MERGED
41128099999   3.45 +NOT MERGED
41268099999  -3.25 MERGED STATION
41240099999  -3.25 +MERGED STATION
78397099999   3.24 NOT MERGED
76577099999   3.16 NOT MERGED
82281099999  -3.06 NOT MERGED
61421099999   3.04 NOT MERGED

DONE RH - ID 
4.42 changepoints per station  (more than 2016)
ABS mean=2.88, st dev=2.22     (v sim to 2016)
Mean = 0.03, st dev=3.64       (v sim to 2016)
mean of diffs=0.05, stdev=1.19 (slightly larger than in 2016, esp stdev)
Largest Adjustments (> 15%rh) 
NONE are the same as for T
Some are same as Td marked +
36982099999 -24.55 NOT MERGED
04231099999  23.75 NOT MERGED
44277099999 -23.08 +NOT MERGED
71437099999  20.31 MERGED STATION
76577099999  19.77 NOT MERGED
44298099999 -18.14 NOT MERGED
44287099999 -17.86 +NOT MERGED
71465099999  17.75 NOT MERGED
01406099999 -17.58 NOT MERGED
70333099999  17.46 MERGED STATION
60714099999 -17.16 NOT MERGED
38545099999 -17.10 NOT MERGED
72393099999  16.96 MERGED STATION
44213099999 -16.74 MERGED STATION
72355599999  16.69 MERGED STATION
71800099999  16.63 NOT MERGED
44284099999 -16.50 +NOT MERGED
47122099999  16.47 NOT MERGED
71261099999  16.14 MERGED STATION
59948099999  16.13 NOT MERGED
76577099999  16.08 NOT MERGED

DONE e - ID
4.33 changepoints per station	(more than 2016)
ABS mean=0.42, st dev=0.47	(v sim to 2016)
Mean = -0.01, st dev=0.63	(v sim to 2016)
mean of diffs=-0.00, stdev=0.25 (v sim to 2016, stdev slightly larger than in 2016)
Largest Adjustments (> 4hPa) 
Some are same as Td marked +
NONE are the same as for T
41240099999  -5.25 +MERGED STATION
78397099999   5.21 NOT MERGED
41268099999  -5.17 MERGED STATION
41128099999   4.88 +NOT MERGED
82281099999  -4.83 NOT MERGED
78520199999   4.78 MERGED STATION
40340099999  -4.76 +NOT MERGED
61421099999   4.74 NOT MERGED
76577099999   4.58 NOT MERGED
61498099999   4.52 +NOT MERGED
84452099999   4.39 NOT MERGED
78367011706   4.36 NOT MERGED
78990099999   4.34 MERGED STATION
76649399999  -4.34 MERGED STATION
78388099999  -4.33 NOT MERGED
80421499999  -4.19 MERGED STATION
91697099999  -4.08 NOT MERGED
91691099999  -4.07 NOT MERGED
41128099999  -4.02 +NOT MERGED
76577099999   4.01 NOT MERGED

DONE Tw - ID 
4.33 changepoints per station  (more than 2016)
ABS mean=0.32, st dev=0.41     (v sim to 2016)
Mean = -0.01, st dev=0.51      (v sim to 2016)
mean of diffs=0.01, stdev=0.22 (slightly larger than in 2016)
Largest Adjustments (> 5 deg) - ALL same as for T
* = also in T
71836099999 -17.74 *MERGED STATION
71749099999 -16.45 *MERGED STATION
71836099999  16.15 *MERGED STATION
71749099999  15.48 *MERGED STATION
71627899999   8.38 *MERGED STATION
71627899999  -7.70 *MERGED STATION
02096099999  -6.22 *MERGED STATION
71836099999   6.00 *MERGED STATION

Overall - slightly higher frequency of changepoints per station
and generally slightly larger stdevs. Means v similar.

THINK ABOUT WHETHER TO REMOVE MORE STATIONS WITH VERY LARGE ADJUSTMENTS IN
VARIABLES OTHER THAN T!!! IT WOULD SEEM SENSIBLE - ESP IF THEY ARE MERGES?
DECISION!!! I am going to remove all stations with adjustments in either T (IDPHAMG) or 
Td (PHADPD) that are larger than 5 degrees. This is still a little arbitrary but I'm 
not sure where to draw the line. Even though PHA is good at removing large jumps it seems
like evidence that the station is of poor quality if such a large jump is present.
This results in 29 unique stations:
T and Td
71836099999 -21.63 ~2007? MERGED STATION
71749099999 -18.61 ~1978-1995? MERGED STATION
71627899999   9.31 ~1977-2012? MERGED STATION
02096099999  -7.01 ~1975-1978? MERGED STATION
11993099999  -5.89 ~1984-1993 or 2002-2007? MERGED STATION
T only
53588099999   5.09 NOT MERGED
Td only
41128099999   8.77 NOT MERGED
44287099999  -7.24 NOT MERGED
61498099999  -7.04 NOT MERGED
72487099999   6.98 MERGED STATION
44277099999  -6.86 NOT MERGED
55664099999  -6.45 NOT MERGED
62103099999  -6.40 NOT MERGED
94488099999  -5.95 NOT MERGED
41240099999  -5.82 MERGED STATION
44284099999  -5.81 NOT MERGED
40260099999   5.79 NOT MERGED
40373099999   5.72 NOT MERGED
40340099999  -5.62 NOT MERGED
40310099999  -5.62 NOT MERGED
60611099999  -5.54 NOT MERGED
40362099999   5.40 NOT MERGED
40394099999  -5.31 NOT MERGED
44373099999   5.26 NOT MERGED
55578099999  -5.23 NOT MERGED
44275099999  -5.21 NOT MERGED
40405099999  -5.21 NOT MERGED
17330099999  -5.06 NOT MERGED
94255099999   5.01 NOT MERGED

Saved these in a list called HadISDH.3.0.0.2016p_LargeAdjT_Td_removals_JAN2017.txt in LISTS_DOCS

9) Manually save 'large' - > 5 deg adjustment stations from T and Td adjustments in a list of unique stations called:
HadISDH.3.0.0.2016p_LargeAdjT_Td_removals_JAN2017.txt in LISTS_DOCS

10) Run program to copy goodstations***(IDPHA, PHAdpd, PHADPDtd) to _KeptLarge.txt and remove 
all stations with T adj > 5 deg listed in Largest_Adjs_landT.3.0.0.2016p_IDPHAMG_JAN2017.txt
from each of the goodstations*** files (IDPHA, PHAdpd and PHADPDtd). 
	I can look at old time series of known issues here: /data/local/hadkw/HADCRUH2/IMAGES/TESTCREATE
	Prog used: test_create_monthseries_MAY2012.pro, can be assessed using: check_HadCRUHstationsMAY2012.pro
	Red line = change of source
	Yellow line = change of frequency
	Blue line = change of resolution
UpdateGoodLists_LargeAdjRemovals_JAN2017.py

RESULTS:	
Updated station counts are now:
    	IDPHA	PHA	PHADPD	MISSED ADJ UNC
T    	4171	4212		
DPD 		4209        	
Td		4211	4171
q	4170	4211
RH	4168	4208
e	4170	4211
Tw	4171	4211

11) Put the missed adjustment uncertainty (st dev of differences) into
create_homogNCDFall_stunc_JAN2015.pro
	
12) COPY HOMOGENISED MONTHLIES TO NETCDF - CREATE ANOMALIES, CLIMS, SDs, STATION UNCERTAINTIES
create_homogNCDFall_stunc_JAN2015.pro (all variables seperately)
	-> calc_evap.pro
	- T first, then RH, DPD, q, e, td, tw
	- Add missed adjustment uncertainty before running.
	- Now cross check PosthomogPHA<var>_satsHadISDH<version>_JAN2017.txt and PosthomogPHA<var>_subzerosHadISDH<version>_JAN2017.txt with each other AND with
	Posthomog<ID>PHA<var>_badsHadISDH<version>_JAN2017.txt - move from sats/subzeros if station appears in bads and annotate bads with SATS or SUBS
	   This is quite a long process - consider automating somehow - better for avoiding error too!

NOTE THAT WE CAN NOW CHOOSE CLIMATOLOGY PERIOD (1976-2005 = HadISDH standard, 1981-2010 International Standard) 
 - > this will result in different goods, bads, subs and sats! 
 - > not quite sure why it would affect subs and sats other than allowing/disallowing different stations
	
RESULTS anoms76-05: 
IDPHA, PHDdpd, PHDDPDtd	
    	goods	bads	subs	sats 	goods (no sats or subs)
T    	4039	132	NA	NA	4039
DPD 	3886	294	NA	227     3659   	
Td	3727	444	NA	221  	3506
q	4149	21	44	38	4067
RH	4148	20	0	38	4110
e	4149	21	45	38	4066
Tw	4150	21	NA	949	3201

13) Propogate totals of goods (no sats and subs), sats, subzeros through to all other programs

		
14) GRID ALL HOMOGENISED STATIONS (AND RAW FOR COMPARISON)
	- now made it all CF compliant and added an ascii grid print out
grid_HadISDHFLAT_JAN2015.pro
	-> calc_samplingerrorJUL2012_nofill.pro

RESULTS:
DONE q ID
DONE RH ID
DONE T ID
DONE e ID
DONE Tw ID
DONE Td PHADPD
DONE DPD PHA

15) CREATE RAW AND HOMOGENISED DECADAL TREND GRIDBOX FIELDS 
make_MP_trends.pro
	-> median_pairwise.pro

RESULTS:
DONE q ID
DONE RH ID
DONE T ID
DONE e ID
DONE Tw ID
DONE Td PHADPD
DONE DPD PHA

16) CREATE RAW AND HOMOGENISED AREA AVERAGED TIME SERIES
make_area_avg_ts.pro
	-> globalmean.pro

RESULTS:
DONE q ID
DONE RH ID
DONE T ID
DONE e ID
DONE Tw ID
DONE Td PHADPD
DONE DPD PHA

17) PLOT RAW VS HOMOGENISED GRIDBOX AND AREA AVERAGE TREND STATS (2013 vs 2014 too)
plot_HadISDH_MPtrendsscat_JAN2014.pro
	-> median_pairwise.pro
	-> plotsym.pro
	-> boxfill.pro
	-> make_key.pro

RESULTS:
DONE q ID
DONE RH ID
DONE T ID (had to expand ymax to 1.2)
DONE e ID
DONE Tw ID
DONE Td PHADPD
DONE DPD PHA

18) PLOT DECADAL TRENDS FOR THE GRIDBOX
plot_HadISDH_MPdectrends_JAN2014.pro (/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/IDL/)
	-> boxfill.pro
	-> make_key.pro
Can also use PlotTrendMap_JAN2015.py in UPDATE2016/PROGS/PYTHON/	***PREFERRED***


19) PLOT ANNUAL ANOMALY MAPS FOR HADOBS
/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/IDL/
run_annualanommaps.pro
plot_annualanommaps_FEB2015.pro
	-> boxfill.pro
	-> make_key.pro
	need to update:
		plot_annualanomaps_FEB2015.pro
		- edyr
		- ensure varid points to q_anoms, rh_anoms et
		run_annualanomaps.pro
		- version, nowmon, nowyear, thenmon,thenyear, homogtype, param 
		- ensure filepaths and pointers are up to date
	Make directories called ANOMS7605_7605 to reflect the use of anoms7605 for producing anomalies relative to 7605 (can choose a different period)
	Move all maps (images and data grids) into these directories for tidiness
	
20) Create the CEDA versions
/data/local/hadkw/HADCRUH2/UPDATE2016/PRnedtOGS/PYTHON/
WriteNetCDF_CEDAESGF_JAN2016.py
Convert_CEDAESGF_JAN2016.py
	- Follow ~hadkw/Desktop/HadISDH/CEDA_DIR/UPDATING_CEDA_README/ to update the CEDA versions
	including documentation
	
RESULTS:
DONE ESGF
DONE Copy ASCII
DONE check table - same
DONE write update doc	

21) hadcruh_uncertainties.py

22) Put up new version on HadOBS (www.metoffice.gov.uk/hadobs/hadisdh)
	- login as hadobs: ssh -Y hadobs@eld256 or ssh -Y hadobs@eldint01
	- set up new version pages
	- copy data across and move old data to old directories
	go into scripts and type: >export_hadisdh to upload

DONE

;------------------------------------------------------------------
DETAILS
;******************************************************************
create_monthseriesJAN2015.pro
Take the updated (QC'd) HadISD hourly T and Td data and calculate hourly: q, e, 
RH, Tw and DPD. Average to monthly using make_months_oddtimesJan2014.pro. Derive
monthly Td and DPD. Create HISTORY files with dates of changes in resolution, 
reporting frequency or merging. Save to netCDF and ASCII and also as a .raw in 
PHA2015.

	Inputs:
	/media/Kate1Ext3//HadISD.2.0.1.2016p/'		; QC'd HadISD stations
	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/HadISD.2.0.1.2016p_candidate_stations.txt'	; full 6103 station list
	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/isd-history_downloaded23JAN2017_1230.txt'	; most recent ISD station list with CIDs 
	/data/local/hadkw/HADCRUH2/UPDATE2016/OTHERDATA/'		;20CR SLP 20CR*7605MSLP_yycompos.151.170.240.10.37.8.8.59.nc

	Outputs:
	/data/local/hadkw/HADCRUH2/UPDATE2016/MONTHLIES/ASCII/'	; directoriies for ASCII
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phav52jgo/data/hadisdh/7316q/monthly/raw/'   ; directories for PHA
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phav52jgo/data/hadisdh/7316e/monthly/raw/'
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phav52jgo/data/hadisdh/7316t/monthly/raw/'
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phav52jgo/data/hadisdh/7316td/monthly/raw/'
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phav52jgo/data/hadisdh/7316tw/monthly/raw/'
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phav52jgo/data/hadisdh/7316rh/monthly/raw/'
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phav52jgo/data/hadisdh/7316slp/monthly/raw/'
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phav52jgo/data/hadisdh/7316ws/monthly/raw/'
	/data/local/hadkw/HADCRUH2/UPDATE2016/MONTHLIES/HISTORY/'	; directory for history files
	/data/local/hadkw/HADCRUH2/UPDATE2016/MONTHLIES/NETCDF/'	; directory for NetCDF files
	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/tooshortforHadISDH.<version>_JAN2017.txt'	; list of removed stations
	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.<version>_JAN2017.txt'		; list of kept stations

;******************************************************************
run direct PHA FOR T and DPD : /data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phsv57jgo/
	INPUTS:
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phsv57jgo/data/hadisdh/7316<var>/monthly/raw:
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phsv57jgo/data/hadisdh/7316<var>/meta:

	OUTPUTS:
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phsv57jgo/runlogs/7316<var>.log
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phsv57jgo/data/hadisdh/7316<var>/corr/corr.7316<var>.tavg.r00.<timedate>
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phsv57jgo/data/hadisdh/7316<var>/outputs/*
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phsv57jgo/data/hadisdh/7316<var>/monthly/WMs.r00/*
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phsv57jgo/data/hadisdh/7316<var>/monthly/FLs.r00/*
	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.<version>_PHA<var>_JAN2017.txt
	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/HadISDH.land<var>.<version>_PHA_JAN2017.log
	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.<version>_IDPHAall_JAN2017.txt
	Station counts for DPD
	
;*******************************************************************	
OutputPHAASCIIPLOT_JAN2014.py
	INPUTS:
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.<version>_PHA<var>_JAN2017.txt  	; station list
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phsv57jgo/data/hadisdh/7316<var>/monthly/WMs.r00/*	; homogenised data
	/data/local/hadkw/HADCRUH2/UPDATE2016/MONTHLIES/ASCII/<VAR>ABS/						; raw data
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phsv57jgo/data/hadisdh/7316<var>/corr/corr.7316<var>.tavg.r00.<timedate> ; neighbour network list	
	Td only:
	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/HadISDH.landDPD.'+version+'_JAN2017.log		; DPD adjustment log
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/HadISDH.landT.'+version+'_IDPHA_JAN2017.log		; T adjustment log
	
	OUTPUTS:
	/data/local/hadkw/HADCRUH2/UPDATE2016/MONTHLIES/HOMOG/PHAASCII/<VAR>DIR/*_PHAadj.txt	; ASCII homogenised data
	/data/local/hadkw/HADCRUH2/UPDATE2016/MONTHLIES/HOMOG/STAT_PLOTS/PHAADJCOMP/<VAR>DIR/*	; raw vs homogenised and neighbours time series plot
	Td only:
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/HadISDH.landTd.'+version+'_DPDPHA_JAN2017.log		; Td merged adjustment log

;*******************************************************************       
IndirectPHA_JAN2014.py
	INPUTS:
	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.<version>_IDPHAall_JAN2017.txt	;station list for T and DPD combined
	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/HadISDH.landT.<version>_PHA_JAN2017.log	; adjustment logs
	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/HadISDH.landDPD.<version>_PHA_JAN2017.log	; adjustment logs
	/data/local/hadkw/HADCRUH2/UPDATE2016/PROGS/PHA2015/phsv57jgo/data/hadisdh/7316<var>/corr/corr.7316<var>.tavg.r00.<timedate>	; neighbour network list
	/data/local/hadkw/HADCRUH2/UPDATE2016/MONTHLIES/ASCII/<VAR>ABS/					; raw data
	T only:
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/HadISDH.landT.'+version+'_IDPHA_JAN2017.log		; adjustment log	
	
	OUTPUTS:
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/HadISDH.land<var>.'+version+'_<homogtype>PHA_JAN2017.log		; adjustment log
	/data/local/hadkw/HADCRUH2/UPDATE2016/MONTHLIES/HOMOG/IDPHAASCII/<VAR>DIR/*_<homogtype>PHAadj.txt	; ASCII homogenised data
	/data/local/hadkw/HADCRUH2/UPDATE2016/MONTHLIES/HOMOG/STAT_PLOTS/IDADJCOMP/<VAR>DIR/*	; raw vs homogenised and neighbours time series plot
	T only:
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/HadISDH.landT.'+version+'_IDPHAMERGE_JAN2017.log		; adjustment log
	Station counts for T (and Td), Tw, q, e, RH
	
;*******************************************************************
plot_HadISDH_adjs_JAN2014.pro
      	INPUTS:
      	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.'+version+'_<homogtype>PHA<var>_JAN2017.txt'
      	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/HadISDH.landq.'+version+'_<homogtype>PHA_JAN2017.log' 
      	OUTPUTS:
      	/data/local/hadkw/HADCRUH2/UPDATE2016/IMAGES/HadISDH.landq.'+version+'_adjspread_<homogtype>PHA_'+nowmon+nowyear+'.eps'
      	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/Largest_Adjs_land<var>.'+version+'_<homogtype>PHA_'+nowmon+nowyear+'.txt'
      	missed adjustment uncertainty value (st dev of estimated complete adjustment distribution minus actual distribution)
	A MANUAL list of T and Td stations with adjustments larger than 5 degrees: HadISDH.3.0.0.2016p_LargeAdjT_Td_removals_JAN2017.txt

;********************************************************************
UpdateGoodLists_LargeAdjRemovals_JAN2017.py
	INPUTS:
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/HadISDH.3.0.0.2016p_LargeAdjT_Td_removals_JAN2017.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_IDPHAt_JAN2017.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_IDPHAq_JAN2017.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_IDPHArh_JAN2017.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_IDPHAe_JAN2017.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_IDPHAtw_JAN2017.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_PHADPDtd_JAN2017.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_PHAdpd_JAN2017.txt
	OUTPUTS:
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_IDPHAt_JAN2017.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_IDPHAq_JAN2017.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_IDPHArh_JAN2017.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_IDPHAe_JAN2017.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_IDPHAtw_JAN2017.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_PHADPDtd_JAN2017.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_PHAdpd_JAN2017.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_IDPHAt_JAN2017_KeptLarge.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_IDPHAq_JAN2017_KeptLarge.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_IDPHArh_JAN2017_KeptLarge.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_IDPHAe_JAN2017_KeptLarge.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_IDPHAtw_JAN2017_KeptLarge.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_PHADPDtd_JAN2017_KeptLarge.txt
        /data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.3.0.0.2016p_PHAdpd_JAN2017_KeptLarge.txt


;********************************************************************
create_homogNCDFall_stunc_JAN2015.pro
    	INPUTS:
	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/goodforHadISDH.'+version+'_<homogtype>PHA<var>_JAN2014.txt
    	/data/local/hadkw/HADCRUH2/UPDATE2016/MONTHLIES/HOMOG/IDPHAASCII/<VAR>DIR/*_PHAadj.txt
       	/data/local/hadkw/HADCRUH2/UPDATE2016/MONTHLIES/HOMOG/IDPHANETCDF/RHDIR/ saturation test and uncertainty bins
       	/data/local/hadkw/HADCRUH2/UPDATE2016/MONTHLIES/HOMOG/IDPHANETCDF/TDIR/ saturation test and uncertainty bins
    	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/HadISDH.landq.'+version+'_IDPHA_JAN2014.log'     ;***
    	OUTPUTS:
	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/Posthomog<homogtype>PHA<var>_anoms7605_goodsHadISDH.'+version+'_'+nowmon+nowyear+'.txt'
     	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/Posthomog<homogtype>PHA<var>_anoms7605_satsHadISDH.'+version+'_'+nowmon+nowyear+'.txt'
    	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/Posthomog<homogtype>PHA<var>_anoms7605_badsHadISDH.'+version+'_'+nowmon+nowyear+'.txt'
	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/Posthomog<homogtype>PHA<var>_anoms7605_subzerosHadISDH.'+version+'_'+nowmon+nowyear+'.txt'
        /data/local/hadkw/HADCRUH2/UPDATE2016/MONTHLIES/HOMOG/IDPHANETCDF/<VAR>DIR/ *anoms7605_*
        /data/local/hadkw/HADCRUH2/UPDATE2016/MONTHLIES/HOMOG/STAT_PLOTS/UNCPLOTS/<VAR>DIR/' *anoms7605_*

;*******************************************************************
grid_HadISDHFLAT_JAN2015.pro
      	INPUTS:
      	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/Posthomog<homogtype>PHA<var>_anoms7605_goodsHadISDH.'+version+'_JAN2017.txt
      	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/Posthomog<homogtype>PHA<var>_anoms7605_satsHadISDH.'+version+'_JAN2017.txt
      	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/Posthomog<homogtype>PHA<var>_anoms7605_subsHadISDH.'+version+'_JAN2017.txt
      	/data/local/hadkw/HADCRUH2/UPDATE2016/MONTHLIES/HOMOG/IDPHANETCDF/<VAR>DIR/ *anoms7605_*
      	/data/local/hadkw/HADCRUH2/UPDATE2016/MONTHLIES/NETCDF/	; raw data
      	OUTPUTS:
      	/data/local/hadkw/HADCRUH2/UPDATE2016/STATISTICS/HadISDH.land<var>.'+version+'_FLATgrid<homogtype>PHA5by5_anoms7605_JAN2017.nc 
      	/data/local/hadkw/HADCRUH2/UPDATE2016/LISTS_DOCS/GriddingResults_3.0.0.2016p_anoms7605_JAN2017.txt	max/mins of all fields in nc file 

;*******************************************************************
make_MP_trends.pro
	INPUTS:
	/data/local/hadkw/HADCRUH2/UPDATE2016/STATISTICS/HadISDH.land<Var>.'+version+'_FLATgrid<homogtype>PHA5by5_anoms7605_JAN2017
	OUTPUTS:
	/data/local/hadkw/HADCRUH2/UPDATE2016/STATISTICS/HadISDH.land<Var>.'+version+'_FLATgrid<homogtype>PHA5by5_JAN2017_anoms7605_MPtrends_19732016.nc
		
;*******************************************************************
make_area_avg_ts.pro
	INPUTS:
	/data/local/hadkw/HADCRUH2/UPDATE2016/STATISTICS/HadISDH.land<Var>.'+version+'_FLATgrid<homogtype>PHA5by5_anoms7605_JAN2014
	OUTPUTS:
	/data/local/hadkw/HADCRUH2/UPDATE2016/STATISTICS/HadISDH.land<Var>.'+version+'_FLATgrid<homogtype>PHA5by5_JAN2014_anoms7605_areaTS_19732013.nc

;*******************************************************************
plot_HadISDH_MPtrendsscat_JAN2014.pro
	INPUTS:
	/data/local/hadkw/HADCRUH2/UPDATE2016/STATISTICS/HadISDH.land<Var>.'+version+'_FLATgrid<homogtype>PHA5by5_JAN2014_anoms7605_MPtrends_19732013.nc
	/data/local/hadkw/HADCRUH2/UPDATE2016/STATISTICS/HadISDH.land<Var>.'+version+'_FLATgrid<homogtype>PHA5by5_JAN2014_anoms7605_areaTS_19732013.nc
	OUTPUTS:
  	/data/local/hadkw/HADCRUH2/UPDATE2016/IMAGES/HadISDH.land<Var>.'+version+'_FLATgrid<homogtype>PHA5by5_JAN2014_anoms7605_MPtrendsscat_19732013.eps

;*******************************************************************
plot_HadISDH_MPdectrends_JAN2014.pro
	INPUTS:
	/data/local/hadkw/HADCRUH2/UPDATE2016/STATISTICS/HadISDH.land<Var>.'+version+'_FLATgrid<homogtype>PHA5by5_JAN2014_anoms7605_MPtrends_19732013.nc
	OUTPUTS:
  	/data/local/hadkw/HADCRUH2/UPDATE2016/IMAGES/HadISDH.land<Var>.'+version+'_FLATgrid<homogtype>PHA5by5_JAN2014_anoms7605_MPdectrends_19732013.eps

;*******************************************************************
BAD STATIONS???
041150 - has two periods of data with a large gap. The earlier period is quite intermittent an has a climatology closer to -30 (T and Td). The second has a climatology closer to 0 (T and Td). Does
not appear to be a station merge. Could be an error in early period (divide by 10?) or in later period (* 10?). Its at 65N so not super high latitude.

;*******************************************************************
NOTE TO KATE:
Some minimum threshold for uncertainties? In some cases measurement uncertainty is zero.

2014 run:
Modifiy make_month_oddtimes to mask abs to anoms or actually create abs from the anoms+clims to reduce biasing
where data are unevenly distributed.

